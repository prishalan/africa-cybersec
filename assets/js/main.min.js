const CONFIG = {
  scripts: {
    particles: "vendors/particles.min.js",
    popper: "vendors/popper.min.js",
    tippy: "vendors/tippy-bundle.umd.min.js",
    svgPanZoom: "vendors/svg-pan-zoom.min.js",
    mapRenderer: "map-renderer.min.js",
    sidebarHandler: "sidebar-handler.min.js",
  },
  dataUrl: "../assets/data/country-data.json",
};
function loadScript(src) {
  return new Promise((resolve, reject) => {
    const script = document.createElement("script");
    script.src = src;
    script.onload = resolve;
    script.onerror = reject;
    document.body.appendChild(script);
  });
}
function showContent() {
  const splash = document.getElementById("splash");
  const app = document.getElementById("app");
  app.style.opacity = "1";
  splash.style.opacity = "0";
  setTimeout(() => {
    splash.style.display = "none";
  }, 500);
}
async function initializeMap(data) {
  const mapRenderer = new MapRenderer("mapContainer");
  await mapRenderer.render(data);
}
async function loadCore() {
  try {
    await Promise.all([
      loadScript(CONFIG.scripts.mapRenderer),
      loadScript(CONFIG.scripts.sidebarHandler),
    ]);
    initializeSidebars();
  } catch (error) {
    console.error("Error loading core scripts:", error);
    throw error;
  }
}
async function loadEnhancements() {
  try {
    await Promise.all([
      loadScript(CONFIG.scripts.particles),
      loadScript(CONFIG.scripts.popper),
      loadScript(CONFIG.scripts.tippy),
      loadScript(CONFIG.scripts.svgPanZoom),
    ]);
    console.log("Enhancement scripts loaded");
  } catch (error) {
    console.error("Error loading enhancement scripts:", error);
    throw error;
  }
}
async function loadApp() {
  try {
    await loadCore();
    const countryData = await fetch(CONFIG.dataUrl).then((resp) => resp.json());
    await loadEnhancements();
    await initializeMap(countryData);
    showContent();
  } catch (error) {
    console.error("Error loading application:", error);
    const splash = document.getElementById("splash");
    splash.innerHTML = `
          <div class="error-message">
              <h2>Error Loading Application</h2>
              <p>Please refresh the page to try again.</p>
          </div>
      `;
  }
}
